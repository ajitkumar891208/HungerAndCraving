<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Testing Phases Demo</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#60a5fa;--ok:#10b981;--bad:#ef4444;--muted:#94a3b8}
    body{font-family:Inter,Segoe UI,Roboto,system-ui,Arial;margin:0;background:linear-gradient(180deg,#071129 0%, #071021 100%);color:#e6eef8}
    .wrap{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:16px;margin-top:18px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,.6)}
    button{background:var(--accent);color:#04283a;border:0;padding:10px 12px;border-radius:8px;font-weight:600;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--muted)}
    .tests-list{display:flex;flex-direction:column;gap:10px}
    .result-pass{color:var(--ok);font-weight:700}
    .result-fail{color:var(--bad);font-weight:700}
    pre{background:#021523;padding:10px;border-radius:8px;overflow:auto}
    .progress{height:12px;background:#05202b;border-radius:8px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,#60a5fa,#7dd3fc)}
    table{width:100%;border-collapse:collapse}
    td,th{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,.03);font-size:13px}
    .mini{font-size:12px;color:var(--muted)}
    canvas{width:100%;height:140px;background:#021523;border-radius:8px}
    footer{margin-top:16px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect rx='8' width='36' height='36' fill='%2360a5fa'/><text x='50%' y='57%' font-size='20' font-family='Arial' text-anchor='middle' fill='%2308141a'>T</text></svg>" alt="logo" style="width:46px;height:46px;border-radius:10px;box-shadow:0 6px 18px rgba(6,10,20,.6)">
      <div>
        <h1>Interactive Web Testing Phases Demo</h1>
        <div class="mini">Run Unit → Integration → Functional → Performance tests visually</div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <h3 style="margin-top:0">Test Runner</h3>
        <div class="tests-list">
          <div style="display:flex;gap:8px;align-items:center">
            <button id="runUnit">Run Unit Tests</button>
            <button class="btn-ghost" id="clear">Clear Results</button>
          </div>

          <div style="display:flex;gap:8px;margin-top:6px">
            <button id="runIntegration">Run Integration Tests</button>
            <button id="runFunctional">Run Functional Tests</button>
          </div>

          <div style="display:flex;gap:8px;margin-top:6px">
            <button id="runPerf">Run Performance Test</button>
            <button id="runAll">Run All (Sequential)</button>
          </div>
        </div>

        <hr style="margin:12px 0;border-color:rgba(255,255,255,.03)">
        <div class="mini">Progress</div>
        <div class="progress" style="margin-top:8px"><i id="progressBar" style="width:0%"></i></div>

        <hr style="margin:12px 0;border-color:rgba(255,255,255,.03)">
        <div class="mini">Performance Chart</div>
        <canvas id="perfChart"></canvas>
      </div>

      <div class="card">
        <h3 style="margin-top:0">Results</h3>
        <div style="max-height:420px;overflow:auto">
          <table id="resultsTable">
            <thead><tr><th>Test</th><th>Phase</th><th>Status</th><th>Details</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <hr style="margin:12px 0;border-color:rgba(255,255,255,.03)">
        <h4 style="margin:4px 0">Sample Application (under test)</h4>
        <div class="mini">A tiny calculator + business rule: sum must be greater than difference.</div>
        <pre id="appCode">// add(a,b) | subtract(a,b) | calculator(a,b) | businessLogic(x,y)</pre>

        <footer>
          Tip: Click <strong>Run All</strong> to see the phases in sequence. The performance test measures average time of repeated ops and plots earlier runs.
        </footer>
      </div>
    </div>
  </div>

  <script>
    // ------------------------
    // Application under test
    // ------------------------
    function add(a,b){ return a + b }
    function subtract(a,b){ return a - b }
    function calculator(a,b){ return {sum: add(a,b), difference: subtract(a,b)} }
    function businessLogic(x,y){ const r = calculator(x,y); return r.sum > r.difference }

    // ------------------------
    // Test harness
    // ------------------------
    const resultsTbody = document.querySelector('#resultsTable tbody')
    const progressBar = document.getElementById('progressBar')
    const perfCanvas = document.getElementById('perfChart')
    const ctx = perfCanvas.getContext('2d')
    let perfHistory = []

    function appendResult(name, phase, ok, details){
      const tr = document.createElement('tr')
      tr.innerHTML = `<td>${name}</td><td>${phase}</td><td class=\"${ok? 'result-pass':'result-fail'}\">${ok? 'PASS':'FAIL'}</td><td>${details}</td>`
      resultsTbody.prepend(tr)
    }

    function setProgress(p){ progressBar.style.width = Math.min(Math.max(p,0),100) + '%' }

    // Unit Tests
    function runUnitTests(){
      return new Promise(resolve => {
        const res = []
        try{
          res.push({name:'add(2,3)==5',ok: add(2,3)===5})
          res.push({name:'subtract(5,3)==2',ok: subtract(5,3)===2})
        }catch(e){res.push({name:'exception',ok:false})}
        // report
        res.forEach(r => appendResult(r.name,'Unit', r.ok, r.ok? '': 'unexpected'))
        resolve(res.every(r=>r.ok))
      })
    }

    // Integration Tests
    function runIntegrationTests(){
      return new Promise(resolve => {
        const ok1 = calculator(5,3).sum === 8
        const ok2 = calculator(5,3).difference === 2
        appendResult('calculator(5,3).sum==8','Integration', ok1, ok1? '':'sum mismatch')
        appendResult('calculator(5,3).difference==2','Integration', ok2, ok2? '':'diff mismatch')
        resolve(ok1 && ok2)
      })
    }

    // Functional Tests
    function runFunctionalTests(){
      return new Promise(resolve => {
        const t1 = businessLogic(5,3) === true
        const t2 = businessLogic(0,0) === false
        appendResult('businessLogic(5,3) === true','Functional', t1, t1? '':'rule broken')
        appendResult('businessLogic(0,0) === false','Functional', t2, t2? '':'rule broken')
        resolve(t1 && t2)
      })
    }

    // Performance Test (measures average time of add() over N iterations)
    async function runPerformanceTest(iterations = 200000){
      // warmup
      for(let i=0;i<1000;i++) add(i,i)
      const start = performance.now()
      for(let i=0;i<iterations;i++){ add(i,i) }
      const end = performance.now()
      const duration = end - start
      const avg = duration / iterations
      appendResult(`add() x ${iterations}`,'Performance', avg < 0.01, `avg=${avg.toFixed(6)} ms`)
      perfHistory.push({iterations, avg})
      drawPerfChart()
      return avg
    }

    // draw simple line chart
    function drawPerfChart(){
      const w = perfCanvas.width = perfCanvas.clientWidth * devicePixelRatio
      const h = perfCanvas.height = perfCanvas.clientHeight * devicePixelRatio
      ctx.clearRect(0,0,w,h)
      if(perfHistory.length===0) return
      const maxAvg = Math.max(...perfHistory.map(p=>p.avg))
      // axes
      ctx.lineWidth = 1 * devicePixelRatio
      ctx.strokeStyle = 'rgba(255,255,255,0.06)'
      ctx.beginPath(); ctx.moveTo(40*devicePixelRatio,10*devicePixelRatio); ctx.lineTo(40*devicePixelRatio,h-20*devicePixelRatio); ctx.lineTo(w-10*devicePixelRatio,h-20*devicePixelRatio); ctx.stroke()
      // plot
      ctx.beginPath();
      perfHistory.forEach((p,i)=>{
        const x = 40*devicePixelRatio + (i/(perfHistory.length-1||1))*(w-60*devicePixelRatio)
        const y = 10*devicePixelRatio + (1 - (p.avg / maxAvg))*(h-40*devicePixelRatio)
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y)
        // dot
        ctx.fillStyle = 'rgba(96,165,250,0.95)'
        ctx.beginPath(); ctx.arc(x,y,3*devicePixelRatio,0,Math.PI*2); ctx.fill();
      })
      ctx.lineWidth = 2*devicePixelRatio; ctx.strokeStyle = 'rgba(96,165,250,0.9)'; ctx.stroke()
      // labels
      ctx.fillStyle = 'rgba(230,238,248,0.85)'; ctx.font = `${12*devicePixelRatio}px Arial`;
      ctx.fillText('Avg ms per add()', 44*devicePixelRatio, 20*devicePixelRatio)
      ctx.fillText(`runs: ${perfHistory.length}`, 44*devicePixelRatio, 36*devicePixelRatio)
    }

    // wiring UI
    document.getElementById('runUnit').addEventListener('click', async ()=>{
      setProgress(10)
      const ok = await runUnitTests()
      setProgress(30)
      if(ok) appendResult('Unit Suite','Unit',true,'All unit tests passed')
      else appendResult('Unit Suite','Unit',false,'Some unit tests failed')
      setProgress(35)
    })

    document.getElementById('runIntegration').addEventListener('click', async ()=>{
      setProgress(40)
      const ok = await runIntegrationTests()
      setProgress(55)
      appendResult('Integration Suite','Integration', ok, ok? 'OK':'Failures present')
      setProgress(60)
    })

    document.getElementById('runFunctional').addEventListener('click', async ()=>{
      setProgress(65)
      const ok = await runFunctionalTests()
      setProgress(80)
      appendResult('Functional Suite','Functional', ok, ok? 'Requirements met':'Requirement failures')
      setProgress(85)
    })

    document.getElementById('runPerf').addEventListener('click', async ()=>{
      setProgress(88)
      await runPerformanceTest(200000)
      setProgress(100)
      setTimeout(()=>setProgress(0),700)
    })

    document.getElementById('runAll').addEventListener('click', async ()=>{
      resultsTbody.innerHTML = ''
      setProgress(2)
      const u = await runUnitTests(); setProgress(20);
      const i = await runIntegrationTests(); setProgress(45);
      const f = await runFunctionalTests(); setProgress(70);
      await runPerformanceTest(200000); setProgress(100)
      appendResult('End-to-end','All', u && i && f, (u && i && f)? 'All phases green':'Some phases failed')
      setTimeout(()=>setProgress(0),900)
    })

    document.getElementById('clear').addEventListener('click', ()=>{ resultsTbody.innerHTML=''; perfHistory=[]; drawPerfChart() })

    // initial draw
    drawPerfChart()

  </script>
</body>
</html>
